<html>

<head>
    <title>Car security app</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


</head>

<body>
    <div class="container">

        <h1 class="display-4" style="width: 100%;text-align: center;">Car security app</h1>
        <div class="row">
            <div class="col-xs-6">
                <img class="img-fluid" style=" height: auto;width:100%; " src="{{ url_for('video_feed') }}">
            </div>
            <div class="col-xs-6">
                <div id="accordion">
                    {% for name,(type,param) in params %}
                    <div class="card">
                        <div class="card-header" id="{{'headingOne'+name}}">
                            <h5 class="mb-0">
                                <button class="btn btn-primary" style="width: 100%;" data-toggle="collapse"
                                    data-target="#{{name}}" aria-expanded="false" aria-controls="{{name}}">
                                    {{type}}
                                </button>
                            </h5>
                        </div>

                        <div id="{{name}}" class="collapse" aria-labelledby="{{'headingOne'+name}}"
                            data-parent="#accordion">
                            <div class="card-body" style="text-align:center;">
                                <form action="">
                                    {% for k,v in param.PARAMS.items() %}
                                    {% set is_checkbox = (str(v).lower() in ['true','false']) %}
                                    <div class="form-group">
                                        <label for="{{k}}" class="mb-2"
                                            style="width: 100%;text-align: center;">{{k}}</label>
                                        <input id="{{k}}" class="form-control mb-2" placeholder="{{k}}"
                                            type="{{ 'checkbox' if is_checkbox else 'text' }}" {{'checked="checked"' if (is_checkbox and str(v).lower() == "true") else ""
                                            }} 
                                            value="{{v}}" 
                                            name="{{k}}">
                                    </div>
                                    {% endfor %}
                                    <input type="hidden" name="type" value="{{type}}">
                                    <button type="submit" class="btn btn-primary">Update</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                </div>
            </div>
        </div>

        <!-- <div id="accordion">
            
        </div> -->
    </div>


    <script>
        function submit(event) {
            event.preventDefault();
            const target = $(event.target)
            const inputs = target.find("input");
            const val = {};
            let type = "";
            // console.log(inputs);
            Array.from(inputs).forEach(e => {
                if (e.getAttribute("type") === "hidden") {
                    type = e.getAttribute("value");
                    return;
                }
                function get_value(e) {
                    if (e.getAttribute("type") === "checkbox") {
                        const val = e.checked ? "True" : "False";
                        return val
                    }
                    return e.value;
                }
                const key = e.getAttribute("name");
                const value = get_value(e);
                val[key] = value;
            })
            const body = JSON.stringify(val);
            const url = "/params/" + type;
            console.log({ url, val })
            $.post(url, data = body, (data) => {
                console.log({ data });
            }).error(e => {
                console.error(e);
            });
        }
        $(window).on(' load', function () {
            Array.from(document.getElementsByTagName("form")).forEach(element => {
                element.addEventListener("submit", submit);
            });
        });
    </script>
</body>

</html>