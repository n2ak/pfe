<html>

<head>
    <title>Car security app</title>
    <!-- <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script> -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


</head>

<body>
    <div class="container">

        <h1>Car security app</h1>
        <div class="row">
            <div class="col-xs-6">
                <img class="img-fluid" style=" height: auto;width:100%; " src="{{ url_for('video_feed') }}">
            </div>
            <div class="col-xs-6">
                <div id="accordion">
                    {% for name,type,params in params %}
                    <div class="card">
                        <div class="card-header" id="{{'headingOne'+name}}">
                            <h5 class="mb-0">
                                <button class="btn btn-primary" style="width: 100%;" data-toggle="collapse"
                                    data-target="#{{name}}" aria-expanded="false" aria-controls="{{name}}">
                                    {{type}}
                                </button>
                            </h5>
                        </div>

                        <div id="{{name}}" class="collapse" aria-labelledby="{{'headingOne'+name}}"
                            data-parent="#accordion">
                            <div class="card-body" style="text-align:center;">
                                <form action="">
                                    {% for k,v in params.PARAMS.items() %}
                                    <div class="form-group">
                                        <label for="{{k}}" class="mb-2"
                                            style="width: 100%;text-align: center;">{{k}}</label>
                                        <input id="{{k}}" class="form-control mb-2" placeholder="{{k}}" type="text"
                                            value="{{v}}" name="{{k}}">
                                    </div>
                                    {% endfor %}
                                    <input type="hidden" name="type" value="{{type}}">
                                    <button type="submit" class="btn btn-primary">Update</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                </div>
            </div>
        </div>

        <!-- <div id="accordion">
            
        </div> -->
    </div>


    <script>
        function submit(event) {
            event.preventDefault();
            const target = $(event.target)
            const inputs = target.find("input");
            const val = {};
            let type = "";
            console.log(inputs);
            Array.from(inputs).forEach(e => {
                if (e.getAttribute("type") === "hidden") {
                    type = e.getAttribute("value");
                    return;
                }
                const key = e.getAttribute("name");
                const value = e.value;
                val[key] = value;
            })
            const body = JSON.stringify(val);
            const url = "/params/" + type;
            console.log({ url, body })
            $.post(url, data = body).error(e => {
                console.error(e);
            });
        }
        $(window).on('load', function () {
            Array.from(document.getElementsByTagName("form")).forEach(element => {
                element.addEventListener("submit", submit);
            });
        });
    </script>
</body>

</html>